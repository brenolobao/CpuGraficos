<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparativo de CPUs - Custo-Benefício</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Comparativo de CPUs por Custo-Benefício</h1>
    </header>
    <main>
        <div class="carousel-container">
            <div class="carousel" id="cpuCarousel">
            </div>
            <button class="carousel-button prev" id="prevButton" onclick="moveCarousel(-1)">&#10094;</button>
            <button class="carousel-button next" id="nextButton" onclick="moveCarousel(1)">&#10095;</button>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const carousel = document.getElementById('cpuCarousel');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            let currentIndex = 0;
            let processedCpus = [];
            let cardWidth = 0; // Será definido após a criação dos primeiros cartões

            // Função para criar um cartão de CPU
            function createCpuCard(cpu, isBestCostBenefit = false) {
                const card = document.createElement('div');
                card.classList.add('cpu-card');
                if (isBestCostBenefit) {
                    card.classList.add('highlight');
                }

                const launchYear = cpu.data_lancamento ? cpu.data_lancamento.split('/')[1] : 'N/A';
                const threadsInfo = cpu.threads !== null ? ` / ${cpu.threads} Threads` : '';

                card.innerHTML = `
                    <h2>${cpu.nome}</h2>
                    <p><strong>Fabricante:</strong> ${cpu.fabricante}</p>
                    <p><strong>Arquitetura:</strong> ${cpu.arquitetura}</p>
                    <p><strong>Ano de Lançamento:</strong> ${launchYear}</p>
                    <p><strong>Núcleos/Threads:</strong> ${cpu.nucleos} Núcleos${threadsInfo}</p>
                    <div class="performance-metrics">
                        <p><strong>Desempenho Single-Core:</strong> ${cpu.desempenho.single_core}</p>
                        <p><strong>Desempenho Multi-Core:</strong> ${cpu.desempenho.multi_core}</p>
                    </div>
                    <p class="cost-benefit"><strong>Custo-Benefício (Multi-Core/Preço):</strong> ${cpu.custo_beneficio.toFixed(2)}</p>
                    <div class="purchase-info">
                        <p><strong>Onde Comprar:</strong></p>
                        <p>Loja: ${cpu.preco_atual[0].ecommerce_name}</p>
                        <p>Preço: $${cpu.preco_atual[0].preco.toFixed(2)}</p>
                        <p><a href="${cpu.preco_atual[0].link_compra}" target="_blank" rel="noopener noreferrer">Comprar Agora</a></p>
                    </div>
                `;
                return card;
            }

            // Lógica do Carrossel (movimento)
            window.moveCarousel = (direction) => {
                const cards = document.querySelectorAll('.cpu-card');
                if (cards.length === 0) return;

                if (cardWidth === 0) { // Garante que cardWidth é calculado apenas uma vez ou quando necessário
                    const cardStyle = getComputedStyle(cards[0]);
                    cardWidth = cards[0].offsetWidth + parseFloat(cardStyle.marginLeft) + parseFloat(cardStyle.marginRight);
                }

                const carouselContainerWidth = carousel.offsetWidth;
                const numVisibleCards = Math.floor(carouselContainerWidth / cardWidth);

                currentIndex += direction;

                // Clamp currentIndex to valid range
                if (currentIndex < 0) {
                    currentIndex = 0;
                } else if (currentIndex > processedCpus.length - numVisibleCards) {
                    currentIndex = processedCpus.length - numVisibleCards;
                    if (currentIndex < 0) currentIndex = 0; // Evita valor negativo se houver poucos cartões
                }

                const offset = -currentIndex * cardWidth;
                carousel.style.transform = `translateX(${offset}px)`;

                // Atualiza o estado dos botões
                updateButtonStates();
            };

            function updateButtonStates() {
                const cards = document.querySelectorAll('.cpu-card');
                if (cards.length === 0) {
                    prevButton.disabled = true;
                    nextButton.disabled = true;
                    return;
                }

                const carouselContainerWidth = carousel.offsetWidth;
                const cardStyle = getComputedStyle(cards[0]);
                // Recalcula a largura do cartão para garantir precisão
                const currentCardWidth = cards[0].offsetWidth + parseFloat(cardStyle.marginLeft) + parseFloat(cardStyle.marginRight);
                const numVisibleCards = Math.floor(carouselContainerWidth / currentCardWidth);

                prevButton.disabled = currentIndex === 0;
                // A desabilitação do botão "next" precisa considerar se todos os cartões já estão visíveis ou se o índice final foi alcançado
                if (processedCpus.length <= numVisibleCards) {
                    nextButton.disabled = true; // Desabilita se todos os cartões couberem
                } else {
                    nextButton.disabled = currentIndex >= processedCpus.length - numVisibleCards;
                }
            }

            // Ajusta a exibição do carrossel ao redimensionar a janela
            window.addEventListener('resize', () => {
                if (processedCpus.length > 0) {
                    cardWidth = 0; // Reseta para recalcular
                    moveCarousel(0); // Recalcula a posição para ajustar ao novo tamanho
                }
            });

            // Faz a requisição para carregar o JSON
            fetch('cpusPrecoAtual.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    processedCpus = data.processadores
                        .filter(cpu => cpu.preco_atual && cpu.preco_atual.length > 0 && cpu.desempenho && cpu.desempenho.multi_core)
                        .map(cpu => {
                            const preco = cpu.preco_atual[0].preco;
                            const custoBeneficio = cpu.desempenho.multi_core / preco;
                            return { ...cpu, custo_beneficio: custoBeneficio };
                        })
                        .sort((a, b) => b.custo_beneficio - a.custo_beneficio);

                    // Adiciona os cartões ao carrossel após carregar e processar os dados
                    processedCpus.forEach((cpu, index) => {
                        // O primeiro CPU (melhor custo-benefício) é destacado
                        carousel.appendChild(createCpuCard(cpu, index === 0));
                    });

                    // Chama a função moveCarousel uma vez para garantir o posicionamento inicial correto
                    // Isso também recalcula o cardWidth com os elementos já renderizados
                    moveCarousel(0);
                })
                .catch(error => {
                    console.error('Erro ao carregar os dados dos CPUs:', error);
                    carousel.innerHTML = '<p style="text-align: center; padding: 20px; color: #dc3545;">Não foi possível carregar os dados dos CPUs. Por favor, tente novamente mais tarde.</p>';
                    prevButton.disabled = true;
                    nextButton.disabled = true;
                });
        });
    </script>
</body>
</html>
